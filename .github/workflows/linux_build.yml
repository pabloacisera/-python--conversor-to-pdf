name: Linux Build

on:
  push:
    branches: [main]
  workflow_dispatch:

# ⚠️ MISMO PERMISO
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install customtkinter fpdf python-docx pyinstaller
    
    - name: Build Linux
      run: |
        pyinstaller --noconfirm --onedir \
          --add-data "core:core" \
          --add-data "gui:gui" \
          --add-data "utils:utils" \
          --name conversor-pdf main.py
    
    - name: Create TAR package
      run: |
        tar -czf conversor-pdf-linux.tar.gz -C dist/conversor-pdf .
    
    - name: Create or Update Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: "linux-latest"
        name: "Linux Latest Build"
        body: "Última versión para Linux - Se actualiza automáticamente"
        files: |
          conversor-pdf-linux.tar.gz
        draft: false
        prerelease: false
        generate_release_notes: false
    
    - name: Upload Artifact (backup)
      uses: actions/upload-artifact@v4
      with:
        name: linux-build-${{ github.run_number }}
        path: conversor-pdf-linux.tar.gz