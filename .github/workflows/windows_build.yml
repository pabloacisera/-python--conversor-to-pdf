name: Windows Build

on:
  push:
    branches: [main]
  workflow_dispatch:

# ‚ö†Ô∏è ESTA L√çNEA ES CLAVE - debe ser la PRIMERA despu√©s de 'on:'
permissions:
  contents: write  # üëà ESTO PERMITE CREAR RELEASES

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        pip install customtkinter fpdf python-docx pyinstaller
    
    - name: Build EXE
      run: |
        pyinstaller --noconfirm --onedir --windowed `
          --add-data "core;core" `
          --add-data "gui;gui" `
          --add-data "utils;utils" `
          --name ConversorPDF `
          --icon gui/assets/logo.ico main.py
    
    - name: Create ZIP
      run: |
        Compress-Archive -Path "dist/ConversorPDF/*" -DestinationPath "ConversorPDF-Windows.zip"
    
    - name: Create or Update Release
      uses: softprops/action-gh-release@v1
      with:
        # Usamos un tag fijo para poder actualizarlo
        tag_name: "windows-latest"
        name: "Windows Latest Build"
        body: "√öltima versi√≥n para Windows - Se actualiza autom√°ticamente"
        files: |
          ConversorPDF-Windows.zip
        draft: false
        prerelease: false
        # ‚ö†Ô∏è ESTO ES IMPORTANTE: permite reemplazar el release si ya existe
        generate_release_notes: false
    
    - name: Upload Artifact (backup)
      uses: actions/upload-artifact@v4
      with:
        name: windows-build-${{ github.run_number }}
        path: ConversorPDF-Windows.zip